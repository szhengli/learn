{"remainingRequest":"C:\\web\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\web\\vue-admin-template\\src\\views\\test\\podlog\\index.vue?vue&type=style&index=0&id=f2a53456&scoped=true&lang=css&","dependencies":[{"path":"C:\\web\\vue-admin-template\\src\\views\\test\\podlog\\index.vue","mtime":1637662059483},{"path":"C:\\web\\vue-admin-template\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\web\\vue-admin-template\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\web\\vue-admin-template\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\web\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\web\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5saW5lew0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiIA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/podlog","sourcesContent":["<template>\r\n  <div >\n\n  <el-select v-model=\"namespace\" placeholder=\"请先选择环境\" v-on:change=\"choose_namespace\">\n    <el-option\n      v-for=\"item in namespaces\"\n      :key=\"item.value\"\n      :label=\"item.label\"\n      :value=\"item.value\">\n    </el-option>\n  </el-select>\n  <el-select v-model=\"pod\" placeholder=\"请选择pod\" v-on:change=\"choose_pod\">\n    <el-option\n      v-for=\"item in pods\"\n      :key=\"item.value\"\n      :label=\"item.label\"\n      :value=\"item.value\">\n    </el-option>\n  </el-select>\n\r\n    <div id=\"logs\" style=\" overflow-y: auto; background:#3f3f3f; color:#009000; font-size: 12px ; width: 1500px; height: 700px;\">\n\n    </div>\n\r\n  </div>\r\n</template>\r\n\r\n<script>\nimport { podlog } from '@/api/podlog'\nimport { get_all_namespaces } from '@/api/kube'\nimport { get_podnames } from '@/api/kube'\n  export default {\n    destroyed(){\n      console.log(\"fuck !!!!!!!!!!!!!!!!!!!!!!!!!!!\")\n      this.pod=\"\"\n      this.show= null\n      this.first= true\n    },\n    methods:{\n      choose_namespace(){\n        let it = this\n        sessionStorage.setItem('selected_namespace', it.namespace)\n        get_podnames({\"namespace\": this.namespace}).then(function (response) {\n          it.pods = response.data.pods\n          var logs = document.getElementById(\"logs\")\n          console.log(\"#################\")\n          console.log(it.first)\n          console.log(\"#################\")\n          if (it.first){\n           it.choose_pod()\n          }else{\n            it.pod=\"\"\n            it.show= false\n            logs.textContent=\"\"\n          }\n          it.first = false\n        })\n      },\n      choose_pod(){\n          \t\tlet it = this\n               it.show= false\n               logs.textContent=\"\"\n               sessionStorage.setItem('selected_pod', it.pod)\n          \t\tthis.podName = this.pod\n          \t\tthis.namespace = this.namespace\n          \t\tthis.randID = Math.random().toString(36).slice(-6);\n          \t\tpodlog({namespace: it.namespace , podName: it.podName, randID:it.randID})\n          \t\t.then(response => {\n          \t\t\tconsole.log(response.data)\n          \t\t})\n          \t\tlet randSid = Math.random().toString(36).slice(-6);\n          \t\tlet url = \"ws://192.168.2.221:5678/\" + this.namespace +\"_\" + this.podName + \"_\"+ this.randID  +\"_\" + randSid\n          \t\tlet ws = new WebSocket(url)\n              it.show = true\n          \t\tws.onmessage = function(event) {\n                if (it.show || it.pod != \"\"){\n                  var entry\n                  var logs = document.getElementById(\"logs\")\n                  entry =document.createElement('p')\n                  entry.textContent= event.data\n                  logs.appendChild(entry)\n                }\n          \t\t}\n\n      }\n    },\n  \tmounted(){\n      console.log(\"happy@@@@@@@@@@@@@@@@@@@@@@@@@@\")\n      let it = this\n      get_all_namespaces().then(function (response) {\n        it.namespaces = response.data.namespaces\n        console.log(it.namespaces)\n  \t})\n\n    let selected_namespace = sessionStorage.getItem(\"selected_namespace\")\n\n    let selected_pod = sessionStorage.getItem(\"selected_pod\")\n    if (selected_namespace) {\n      it.namespace = selected_namespace\n       this.choose_namespace()\n    }\n    if (selected_pod) {\n      it.pod = selected_pod\n    }\n\n\n    },\n\n  \tdata(){\n  \t\treturn {\n        first: true,\n        namespace: \"\",\n        namespaces:[],\n        pod: \"\",\n        pods: [],\n        msg:  '',\n        namespace: '',\n        podName: '',\n        randID:'',\n        show: false\n  \t\t}\n  \t}\n\n  }\n\n\r\n</script>\r\n\r\n<style scoped>\r\n.line{\r\n  text-align: center;\r\n}\r\n</style>\r\n"]}]}