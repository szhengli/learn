{"remainingRequest":"C:\\web\\devops\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\web\\devops\\src\\views\\test\\podlog\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\web\\devops\\src\\views\\test\\podlog\\index.vue","mtime":1637662059483},{"path":"C:\\web\\devops\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\web\\devops\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\web\\devops\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\web\\devops\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHBvZGxvZyB9IGZyb20gJ0AvYXBpL3BvZGxvZycKaW1wb3J0IHsgZ2V0X2FsbF9uYW1lc3BhY2VzIH0gZnJvbSAnQC9hcGkva3ViZScKaW1wb3J0IHsgZ2V0X3BvZG5hbWVzIH0gZnJvbSAnQC9hcGkva3ViZScKICBleHBvcnQgZGVmYXVsdCB7CiAgICBkZXN0cm95ZWQoKXsKICAgICAgY29uc29sZS5sb2coImZ1Y2sgISEhISEhISEhISEhISEhISEhISEhISEhISEhIikKICAgICAgdGhpcy5wb2Q9IiIKICAgICAgdGhpcy5zaG93PSBudWxsCiAgICAgIHRoaXMuZmlyc3Q9IHRydWUKICAgIH0sCiAgICBtZXRob2RzOnsKICAgICAgY2hvb3NlX25hbWVzcGFjZSgpewogICAgICAgIGxldCBpdCA9IHRoaXMKICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdzZWxlY3RlZF9uYW1lc3BhY2UnLCBpdC5uYW1lc3BhY2UpCiAgICAgICAgZ2V0X3BvZG5hbWVzKHsibmFtZXNwYWNlIjogdGhpcy5uYW1lc3BhY2V9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaXQucG9kcyA9IHJlc3BvbnNlLmRhdGEucG9kcwogICAgICAgICAgdmFyIGxvZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9ncyIpCiAgICAgICAgICBjb25zb2xlLmxvZygiIyMjIyMjIyMjIyMjIyMjIyMiKQogICAgICAgICAgY29uc29sZS5sb2coaXQuZmlyc3QpCiAgICAgICAgICBjb25zb2xlLmxvZygiIyMjIyMjIyMjIyMjIyMjIyMiKQogICAgICAgICAgaWYgKGl0LmZpcnN0KXsKICAgICAgICAgICBpdC5jaG9vc2VfcG9kKCkKICAgICAgICAgIH1lbHNlewogICAgICAgICAgICBpdC5wb2Q9IiIKICAgICAgICAgICAgaXQuc2hvdz0gZmFsc2UKICAgICAgICAgICAgbG9ncy50ZXh0Q29udGVudD0iIgogICAgICAgICAgfQogICAgICAgICAgaXQuZmlyc3QgPSBmYWxzZQogICAgICAgIH0pCiAgICAgIH0sCiAgICAgIGNob29zZV9wb2QoKXsKICAgICAgICAgIAkJbGV0IGl0ID0gdGhpcwogICAgICAgICAgICAgICBpdC5zaG93PSBmYWxzZQogICAgICAgICAgICAgICBsb2dzLnRleHRDb250ZW50PSIiCiAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NlbGVjdGVkX3BvZCcsIGl0LnBvZCkKICAgICAgICAgIAkJdGhpcy5wb2ROYW1lID0gdGhpcy5wb2QKICAgICAgICAgIAkJdGhpcy5uYW1lc3BhY2UgPSB0aGlzLm5hbWVzcGFjZQogICAgICAgICAgCQl0aGlzLnJhbmRJRCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKC02KTsKICAgICAgICAgIAkJcG9kbG9nKHtuYW1lc3BhY2U6IGl0Lm5hbWVzcGFjZSAsIHBvZE5hbWU6IGl0LnBvZE5hbWUsIHJhbmRJRDppdC5yYW5kSUR9KQogICAgICAgICAgCQkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAJCQljb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKQogICAgICAgICAgCQl9KQogICAgICAgICAgCQlsZXQgcmFuZFNpZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKC02KTsKICAgICAgICAgIAkJbGV0IHVybCA9ICJ3czovLzE5Mi4xNjguMi4yMjE6NTY3OC8iICsgdGhpcy5uYW1lc3BhY2UgKyJfIiArIHRoaXMucG9kTmFtZSArICJfIisgdGhpcy5yYW5kSUQgICsiXyIgKyByYW5kU2lkCiAgICAgICAgICAJCWxldCB3cyA9IG5ldyBXZWJTb2NrZXQodXJsKQogICAgICAgICAgICAgIGl0LnNob3cgPSB0cnVlCiAgICAgICAgICAJCXdzLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoaXQuc2hvdyB8fCBpdC5wb2QgIT0gIiIpewogICAgICAgICAgICAgICAgICB2YXIgZW50cnkKICAgICAgICAgICAgICAgICAgdmFyIGxvZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9ncyIpCiAgICAgICAgICAgICAgICAgIGVudHJ5ID1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJykKICAgICAgICAgICAgICAgICAgZW50cnkudGV4dENvbnRlbnQ9IGV2ZW50LmRhdGEKICAgICAgICAgICAgICAgICAgbG9ncy5hcHBlbmRDaGlsZChlbnRyeSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgIAkJfQoKICAgICAgfQogICAgfSwKICAJbW91bnRlZCgpewogICAgICBjb25zb2xlLmxvZygiaGFwcHlAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCIpCiAgICAgIGxldCBpdCA9IHRoaXMKICAgICAgZ2V0X2FsbF9uYW1lc3BhY2VzKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpdC5uYW1lc3BhY2VzID0gcmVzcG9uc2UuZGF0YS5uYW1lc3BhY2VzCiAgICAgICAgY29uc29sZS5sb2coaXQubmFtZXNwYWNlcykKICAJfSkKCiAgICBsZXQgc2VsZWN0ZWRfbmFtZXNwYWNlID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgic2VsZWN0ZWRfbmFtZXNwYWNlIikKCiAgICBsZXQgc2VsZWN0ZWRfcG9kID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgic2VsZWN0ZWRfcG9kIikKICAgIGlmIChzZWxlY3RlZF9uYW1lc3BhY2UpIHsKICAgICAgaXQubmFtZXNwYWNlID0gc2VsZWN0ZWRfbmFtZXNwYWNlCiAgICAgICB0aGlzLmNob29zZV9uYW1lc3BhY2UoKQogICAgfQogICAgaWYgKHNlbGVjdGVkX3BvZCkgewogICAgICBpdC5wb2QgPSBzZWxlY3RlZF9wb2QKICAgIH0KCgogICAgfSwKCiAgCWRhdGEoKXsKICAJCXJldHVybiB7CiAgICAgICAgZmlyc3Q6IHRydWUsCiAgICAgICAgbmFtZXNwYWNlOiAiIiwKICAgICAgICBuYW1lc3BhY2VzOltdLAogICAgICAgIHBvZDogIiIsCiAgICAgICAgcG9kczogW10sCiAgICAgICAgbXNnOiAgJycsCiAgICAgICAgbmFtZXNwYWNlOiAnJywKICAgICAgICBwb2ROYW1lOiAnJywKICAgICAgICByYW5kSUQ6JycsCiAgICAgICAgc2hvdzogZmFsc2UKICAJCX0KICAJfQoKICB9CgoNCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"index.vue","sourceRoot":"src/views/test/podlog","sourcesContent":["<template>\r\n  <div >\n\n  <el-select v-model=\"namespace\" placeholder=\"请先选择环境\" v-on:change=\"choose_namespace\">\n    <el-option\n      v-for=\"item in namespaces\"\n      :key=\"item.value\"\n      :label=\"item.label\"\n      :value=\"item.value\">\n    </el-option>\n  </el-select>\n  <el-select v-model=\"pod\" placeholder=\"请选择pod\" v-on:change=\"choose_pod\">\n    <el-option\n      v-for=\"item in pods\"\n      :key=\"item.value\"\n      :label=\"item.label\"\n      :value=\"item.value\">\n    </el-option>\n  </el-select>\n\r\n    <div id=\"logs\" style=\" overflow-y: auto; background:#3f3f3f; color:#009000; font-size: 12px ; width: 1500px; height: 700px;\">\n\n    </div>\n\r\n  </div>\r\n</template>\r\n\r\n<script>\nimport { podlog } from '@/api/podlog'\nimport { get_all_namespaces } from '@/api/kube'\nimport { get_podnames } from '@/api/kube'\n  export default {\n    destroyed(){\n      console.log(\"fuck !!!!!!!!!!!!!!!!!!!!!!!!!!!\")\n      this.pod=\"\"\n      this.show= null\n      this.first= true\n    },\n    methods:{\n      choose_namespace(){\n        let it = this\n        sessionStorage.setItem('selected_namespace', it.namespace)\n        get_podnames({\"namespace\": this.namespace}).then(function (response) {\n          it.pods = response.data.pods\n          var logs = document.getElementById(\"logs\")\n          console.log(\"#################\")\n          console.log(it.first)\n          console.log(\"#################\")\n          if (it.first){\n           it.choose_pod()\n          }else{\n            it.pod=\"\"\n            it.show= false\n            logs.textContent=\"\"\n          }\n          it.first = false\n        })\n      },\n      choose_pod(){\n          \t\tlet it = this\n               it.show= false\n               logs.textContent=\"\"\n               sessionStorage.setItem('selected_pod', it.pod)\n          \t\tthis.podName = this.pod\n          \t\tthis.namespace = this.namespace\n          \t\tthis.randID = Math.random().toString(36).slice(-6);\n          \t\tpodlog({namespace: it.namespace , podName: it.podName, randID:it.randID})\n          \t\t.then(response => {\n          \t\t\tconsole.log(response.data)\n          \t\t})\n          \t\tlet randSid = Math.random().toString(36).slice(-6);\n          \t\tlet url = \"ws://192.168.2.221:5678/\" + this.namespace +\"_\" + this.podName + \"_\"+ this.randID  +\"_\" + randSid\n          \t\tlet ws = new WebSocket(url)\n              it.show = true\n          \t\tws.onmessage = function(event) {\n                if (it.show || it.pod != \"\"){\n                  var entry\n                  var logs = document.getElementById(\"logs\")\n                  entry =document.createElement('p')\n                  entry.textContent= event.data\n                  logs.appendChild(entry)\n                }\n          \t\t}\n\n      }\n    },\n  \tmounted(){\n      console.log(\"happy@@@@@@@@@@@@@@@@@@@@@@@@@@\")\n      let it = this\n      get_all_namespaces().then(function (response) {\n        it.namespaces = response.data.namespaces\n        console.log(it.namespaces)\n  \t})\n\n    let selected_namespace = sessionStorage.getItem(\"selected_namespace\")\n\n    let selected_pod = sessionStorage.getItem(\"selected_pod\")\n    if (selected_namespace) {\n      it.namespace = selected_namespace\n       this.choose_namespace()\n    }\n    if (selected_pod) {\n      it.pod = selected_pod\n    }\n\n\n    },\n\n  \tdata(){\n  \t\treturn {\n        first: true,\n        namespace: \"\",\n        namespaces:[],\n        pod: \"\",\n        pods: [],\n        msg:  '',\n        namespace: '',\n        podName: '',\n        randID:'',\n        show: false\n  \t\t}\n  \t}\n\n  }\n\n\r\n</script>\r\n\r\n<style scoped>\r\n.line{\r\n  text-align: center;\r\n}\r\n</style>\r\n"]}]}